{
  "id": "da-172",
  "question": "In a distributed database system, how would you implement a two-phase commit protocol to ensure atomicity across multiple nodes, and what are the key failure scenarios you must handle?",
  "answer": "Use coordinator to prepare/commit phases, handle node failures, timeouts, and network partitions with recovery protocols.",
  "explanation": "## Two-Phase Commit Implementation\n\n### Phase 1: Prepare\n1. **Coordinator sends prepare** to all participants\n2. **Participants validate** they can commit (lock resources, write to log)\n3. **Participants respond** with 'vote-commit' or 'vote-abort'\n\n### Phase 2: Commit\n- If all vote-commit: coordinator sends commit, participants acknowledge\n- If any vote-abort: coordinator sends abort, participants rollback\n\n### Failure Scenarios\n1. **Coordinator failure during prepare**: Participants timeout and abort\n2. **Coordinator failure after decision**: Use transaction logs to recover\n3. **Participant failure**: Coordinator retries, other participants wait\n4. **Network partition**: Timeout mechanisms prevent indefinite blocking\n\n### Optimizations\n- **Three-phase commit** adds pre-commit phase to reduce blocking\n- **Paxos/Raft** for coordinator election\n- **Timeout handling** with exponential backoff",
  "diagram": "graph TD\n    A[Coordinator] -->|Prepare Request| B[Participant 1]\n    A -->|Prepare Request| C[Participant 2]\n    A -->|Prepare Request| D[Participant 3]\n    B -->|Vote-Commit| A\n    C -->|Vote-Commit| A\n    D -->|Vote-Commit| A\n    A -->|Global Commit| B\n    A -->|Global Commit| C\n    A -->|Global Commit| D\n    B -->|Ack| A\n    C -->|Ack| A\n    D -->|Ack| A\n    E[Failure Scenario] --> F[Coordinator Crash]\n    E --> G[Participant Timeout]\n    E --> H[Network Partition]",
  "difficulty": "advanced",
  "tags": [
    "acid",
    "transactions"
  ],
  "lastUpdated": "2025-12-14T01:18:08.909Z"
}